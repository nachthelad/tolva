import type { Logger } from "./logger"

const malwareScanEndpoint = process.env.MALWARE_SCAN_WEBHOOK_URL

export type MalwareScanPayload = {
  bucketName: string
  filePath: string
  checksumSha256: string
  mimeType: string
  sizeBytes: number
}

export async function maybeEnqueueMalwareScan(payload: MalwareScanPayload, logger?: Logger) {
  if (!malwareScanEndpoint || typeof fetch !== "function") {
    return
  }
  try {
    await fetch(malwareScanEndpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    })
    logger?.debug("Malware scan requested", { payload })
  } catch (error) {
    logger?.warn("Failed to enqueue malware scan", { error, payload })
  }
}
